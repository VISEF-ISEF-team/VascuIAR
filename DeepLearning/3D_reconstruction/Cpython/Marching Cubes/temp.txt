import numpy as np
cimport numpy as np
from numpy.typing import NDArray

DirectionX = 0
DirectionY = 1
DirectionZ = 2

cdef np.uint8_t[:, :] EDGE_DELTA = np.asarray(
    [
        [0, 0, 0],
        [1, 0, 0],
        [0, 1, 0],
        [0, 0, 0],
        [0, 0, 1],
        [1, 0, 1],
        [0, 1, 1],
        [0, 0, 1],
        [0, 0, 0],
        [1, 0, 0],
        [1, 1, 0],
        [0, 1, 0],
    ],
    dtype=np.uint8,
)

cdef np.uint8_t[:] EDGE_DIRECTION = np.asarray(
    [
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
    ],
    dtype=np.uint8,
)

cdef np.int8_t[:, :] GEOMETRY_LOOKUP = np.asarray(
    [
        [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 0 = 00000000
        [0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 1 = 00000001
        [0, 1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 2 = 00000010
        [8, 3, 9, 1, 3, 9, -1, -1, -1, -1, -1, -1],  # 3 = 00000011
        [1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 4 = 00000100
        [0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1],  # 5 = 00000101
        [9, 10, 0, 2, 10, 0, -1, -1, -1, -1, -1, -1],  # 6 = 00000110
        [8, 3, 10, 2, 3, 10, 10, 9, 8, -1, -1, -1],  # 7 = 00000111
        [3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 8 = 00001000
        [0, 2, 8, 11, 2, 8, -1, -1, -1, -1, -1, -1],  # 9 = 00001001
        [1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1],  # 10 = 00001010
        [1, 2, 9, 11, 2, 9, 9, 8, 11, -1, -1, -1],  # 11 = 00001011
        [10, 1, 11, 3, 1, 11, -1, -1, -1, -1, -1, -1],  # 12 = 00001100
        [0, 1, 8, 10, 1, 8, 8, 11, 10, -1, -1, -1],  # 13 = 00001101
        [9, 0, 11, 3, 0, 11, 11, 10, 9, -1, -1, -1],  # 14 = 00001110
        [8, 9, 11, 10, 9, 11, -1, -1, -1, -1, -1, -1],  # 15 = 00001111
        [4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 16 = 00010000
        [4, 3, 0, 7, 3, 0, 0, 9, 7, -1, -1, -1],  # 17 = 00010001
        [0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1],  # 18 = 00010010
        [4, 3, 1, 9, 4, 1, 7, 3, 1, -1, -1, -1],  # 19 = 00010011
        [1, 2, 10, 8, 4, 7, -1, -1, -1, -1, -1, -1],  # 20 = 00010100
        [3, 4, 7, 3, 0, 4, 1, 2, 10, -1, -1, -1],  # 21 = 00010101
        [9, 10, 2, 4, 7, 8, 0, 2, 9, -1, -1, -1],  # 22 = 00010110
        [2, 10, 4, 7, 10, 9, 4, 9, 7, -1, -1, -1],  # 23 = 00010111
        [8, 4, 7, 3, 11, 2, -1, -1, -1, -1, -1, -1],  # 24 = 00011000
        [4, 7, 11, 2, 0, 1, 9, -1, -1, -1, -1, -1],  # 25 = 00011001
        [0, 11, 2, 8, 4, 7, -1, -1, -1, -1, -1, -1],  # 26 = 00011010
        [4, 7, 11, 2, 1, 9, 11, 2, 9, -1, -1, -1],  # 27 = 00011011
        [3, 10, 11, 7, 8, 4, -1, -1, -1, -1, -1, -1],  # 28 = 00011100
        [7, 11, 4, 1, 9, 10, 2, 4, 7, -1, -1, -1],  # 29 = 00011101
        [9, 10, 11, 7, 11, 4, 9, 11, 10, -1, -1, -1],  # 30 = 00011110
        [10, 11, 7, 8, 4, 10, 9, 10, 8, -1, -1, -1],  # 31 = 00011111
        [7, 4, 9, 10, 9, 5, -1, -1, -1, -1, -1, -1],  # 32 = 00100000
        [3, 0, 8, 7, 7, 4, 9, 10, 9, 4, 5, 10],  # 33 = 00100001
        [4, 5, 1, 0, 7, 4, 0, 7, 8, 0, -1, -1],  # 34 = 00100010
        [5, 1, 2, 7, 4, 9, 7, 2, 3, 7, -1, -1],  # 35 = 00100011
        [2, 3, 11, 10, 9, 7, 7, 4, 9, 7, -1, -1],  # 36 = 00100100
        [9, 7, 4, 5, 10, 2, 10, 3, 2, -1, -1, -1],  # 37 = 00100101
        [4, 5, 1, 0, 3, 2, 9, 7, 2, 9, 10, 3],  # 38 = 00100110
        [4, 5, 9, 7, 11, 10, 11, 3, 2, 11, 10, 3],  # 39 = 00100111
        [7, 4, 9, 10, 9, 5, 3, 8, 2, -1, -1, -1],  # 40 = 00101000
        [9, 10, 7, 5, 7, 4, 0, 8, 1, -1, -1, -1],  # 41 = 00101001
        [3, 7, 4, 3, 4, 0, 1, 2, 5, 5, 4, 1],  # 42 = 00101010
        [2, 5, 1, 7, 4, 9, 7, 2, 3, 7, -1, -1],  # 43 = 00101011
        [4, 5, 9, 7, 11, 10, 11, 3, 2, 11, 10, 3],  # 44 = 00101100
        [5, 10, 7, 11, 7, 4, 3, 2, 8, -1, -1, -1],  # 45 = 00101101
        [9, 10, 11, 7, 11, 4, 9, 11, 10, -1, -1, -1],  # 46 = 00101110
        [10, 11, 7, 8, 4, 10, 9, 10, 8, -1, -1, -1],  # 47 = 00101111
        [9, 5, 4, 6, -1, -1, -1, -1, -1, -1, -1, -1],  # 48 = 00110000
        [3, 6, 0, 5, 4, 6, 0, 3, 6, -1, -1, -1],  # 49 = 00110001
        [0, 5, 4, 1, 6, 7, -1, -1, -1, -1, -1, -1],  # 50 = 00110010
        [4, 1, 6, 7, 4, 6, 5, 1, 6, -1, -1, -1],  # 51 = 00110011
        [8, 4, 7, 3, 9, 5, -1, -1, -1, -1, -1, -1],  # 52 = 00110100
        [0, 5, 4, 1, 3, 8, 7, 3, 9, 8, -1, -1],  # 53 = 00110101
        [9, 5, 4, 1, 2, 6, 7, 9, 7, 8, 9, -1],  # 54 = 00110110
        [2, 6, 7, 0, 2, 7, 3, 0, 7, -1, -1, -1],  # 55 = 00110111
        [7, 3, 2, 6, 8, 4, 9, 7, 8, 9, 6, 8],  # 56 = 00111000
        [4, 9, 6, 7, 5, 4, 6, 6, 2, 7, 6, 9],  # 57 = 00111001
        [7, 3, 0, 6, 0, 5, 4, 6, 0, -1, -1, -1],  # 58 = 00111010
        [6, 7, 5, 4, 8, 4, 3, 6, 4, -1, -1, -1],  # 59 = 00111011
        [0, 1, 9, 4, 6, 7, 3, 2, -1, -1, -1, -1],  # 60 = 00111100
        [7, 8, 4, 6, 0, 9, 6, 2, 9, -1, -1, -1],  # 61 = 00111101
        [0, 3, 6, 8, 7, 6, 4, 9, -1, -1, -1, -1],  # 62 = 00111110
        [9, 6, 7, 4, 9, 7, 5, 1, 6, -1, -1, -1],  # 63 = 00111111
        [4, 5, 9, 10, 9, 11, 10, -1, -1, -1, -1, -1],  # 64 = 01000000
        [0, 3, 8, 7, 4, 5, 9, 10, 9, 5, 11, 10],  # 65 = 01000001
        [5, 1, 4, 5, 0, 4, 9, 10, 9, 4, 7, 10],  # 66 = 01000010
        [0, 1, 9, 8, 7, 11, 4, 7, 4, 5, 11, 7],  # 67 = 01000011
        [3, 11, 10, 8, 4, 7, 9, 4, 9, 5, 7, 4],  # 68 = 01000100
        [9, 5, 4, 0, 3, 2, 11, 10, 8, 7, -1, -1],  # 69 = 01000101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 1, 3],  # 70 = 01000110
        [9, 5, 4, 2, 11, 10, 3, 2, 10, 7, 3, 10],  # 71 = 01000111
        [4, 5, 1, 0, 11, 10, 7, 11, 7, 3, 10, 11],  # 72 = 01001000
        [11, 10, 7, 0, 1, 3, 0, 7, 4, 0, -1, -1],  # 73 = 01001001
        [4, 5, 9, 10, 11, 2, 11, 3, 2, -1, -1, -1],  # 74 = 01001010
        [2, 11, 3, 9, 10, 2, 5, 9, 2, 4, 9, 5],  # 75 = 01001011
        [4, 5, 1, 0, 3, 2, 11, 10, 8, 7, -1, -1],  # 76 = 01001100
        [0, 2, 11, 10, 8, 7, 0, 9, 2, 0, 5, 9],  # 77 = 01001101
        [0, 4, 5, 9, 10, 2, 3, 11, 7, -1, -1, -1],  # 78 = 01001110
        [2, 11, 10, 3, 0, 4, 9, 0, 2, 4, 0, 7],  # 79 = 01001111
        [8, 4, 7, 3, 9, 10, 9, 5, 10, -1, -1, -1],  # 80 = 01010000
        [0, 1, 5, 10, 5, 4, 3, 8, 7, -1, -1, -1],  # 81 = 01010001
        [10, 5, 4, 0, 1, 2, 7, 3, 8, -1, -1, -1],  # 82 = 01010010
        [9, 7, 5, 9, 5, 4, 10, 2, 1, -1, -1, -1],  # 83 = 01010011
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 84 = 01010100
        [5, 11, 10, 5, 10, 2, 3, 8, 7, -1, -1, -1],  # 85 = 01010101
        [4, 11, 10, 4, 9, 11, 7, 11, 9, 2, 11, 10],  # 86 = 01010110
        [3, 9, 7, 3, 10, 9, 10, 2, 7, 10, 9, 4],  # 87 = 01010111
        [8, 4, 7, 3, 9, 5, 10, 9, 10, 2, 11, 10],  # 88 = 01011000
        [5, 10, 9, 7, 5, 9, 4, 7, 9, -1, -1, -1],  # 89 = 01011001
        [0, 10, 2, 4, 9, 5, 7, 3, 8, -1, -1, -1],  # 90 = 01011010
        [0, 4, 7, 9, 0, 7, 10, 0, 10, 2, 9, 10],  # 91 = 01011011
        [8, 4, 7, 3, 11, 2, 9, 5, 10, -1, -1, -1],  # 92 = 01011100
        [9, 5, 10, 11, 2, 8, 11, 10, 3, 8, 10, 2],  # 93 = 01011101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 94 = 01011110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 95 = 01011111
        [9, 5, 4, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 96 = 01100000
        [0, 2, 8, 7, 0, 1, 5, 0, 5, 4, 2, 5],  # 97 = 01100001
        [0, 9, 5, 2, 3, 8, 2, 1, 3, -1, -1, -1],  # 98 = 01100010
        [9, 5, 4, 2, 3, 1, 3, 2, 0, -1, -1, -1],  # 99 = 01100011
        [8, 4, 7, 3, 9, 5, 10, 9, 10, 2, 11, 10],  # 100 = 01100100
        [0, 10, 2, 4, 9, 5, 8, 3, 1, 7, -1, -1],  # 101 = 01100101
        [7, 3, 5, 4, 3, 2, 5, 3, 10, 5, 2, 10],  # 102 = 01100110
        [9, 5, 4, 1, 7, 10, 3, 7, 2, 10, 7, 1],  # 103 = 01100111
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 104 = 01101000
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 1, 3],  # 105 = 01101001
        [11, 10, 5, 1, 3, 0, 7, 8, 4, -1, -1, -1],  # 106 = 01101010
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 107 = 01101011
        [9, 5, 4, 0, 11, 10, 1, 11, 0, 7, 11, 1],  # 108 = 01101100
        [11, 10, 1, 0, 7, 8, 11, 7, 1, 4, 11, 8],  # 109 = 01101101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 110 = 01101110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 111 = 01101111
        [9, 5, 4, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 112 = 01110000
        [4, 9, 5, 7, 0, 1, 2, 7, 2, 11, 7, 1],  # 113 = 01110001
        [9, 5, 4, 7, 3, 8, 2, 7, 2, 11, 7, 3],  # 114 = 01110010
        [11, 2, 0, 1, 7, 4, 9, 7, 9, 5, 7, 1],  # 115 = 01110011
        [5, 4, 9, 8, 7, 10, 7, 2, 10, -1, -1, -1],  # 116 = 01110100
        [3, 7, 0, 5, 1, 2, 7, 1, 7, 10, 10, 2],  # 117 = 01110101
        [10, 7, 5, 2, 10, 5, 3, 2, 5, 8, 3, 5],  # 118 = 01110110
        [9, 7, 5, 9, 10, 7, 10, 1, 7, 10, 0, 1],  # 119 = 01110111
        [4, 10, 9, 7, 4, 9, 5, 7, 4, 5, 2, 7],  # 120 = 01111000
        [3, 7, 0, 5, 10, 1, 4, 10, 5, 7, 10, 1],  # 121 = 01111001
        [0, 5, 4, 1, 3, 8, 7, 3, 4, 8, 5, 4],  # 122 = 01111010
        [9, 3, 0, 10, 10, 5, 7, 10, 7, 4, 10, 5],  # 123 = 01111011
        [7, 3, 2, 10, 10, 5, 7, 10, 7, 4, 10, 5],  # 124 = 01111100
        [8, 10, 5, 8, 7, 10, 7, 2, 10, 7, 4, 2],  # 125 = 01111101
        [10, 9, 7, 10, 7, 2, 9, 4, 7, -1, -1, -1],  # 126 = 01111110
        [9, 7, 4, 10, 9, 10, 5, 10, 4, 10, 5, 2],  # 127 = 01111111
        [9, 5, 4, 6, 11, 10, -1, -1, -1, -1, -1, -1],  # 128 = 10000000
        [11, 10, 6, 9, 6, 4, 0, 3, 8, -1, -1, -1],  # 129 = 10000001
        [4, 6, 11, 8, 7, 10, 9, 8, 9, 5, 7, 8],  # 130 = 10000010
        [2, 6, 0, 3, 11, 10, 9, 11, 9, 5, 7, 11],  # 131 = 10000011
        [8, 7, 10, 7, 2, 10, 9, 5, 4, 6, 11, -1],  # 132 = 10000100
        [9, 7, 10, 9, 10, 2, 6, 11, 9, 6, 9, 5],  # 133 = 10000101
        [10, 6, 7, 7, 1, 10, 1, 0, 10, -1, -1, -1],  # 134 = 10000110
        [10, 6, 7, 7, 1, 10, 1, 0, 10, -1, -1, -1],  # 135 = 10000111
        [7, 8, 9, 5, 11, 10, 6, 11, 6, 0, 11, 5],  # 136 = 10001000
        [0, 5, 11, 10, 6, 0, 11, 0, 6, 1, 11, 5],  # 137 = 10001001
        [8, 3, 11, 5, 5, 4, 8, 5, 8, 7, 11, 4],  # 138 = 10001010
        [11, 10, 6, 7, 11, 6, 8, 4, 11, 8, 5, 4],  # 139 = 10001011
        [5, 9, 6, 4, 0, 2, 6, 5, 6, 9, 7, 11],  # 140 = 10001100
        [9, 5, 0, 2, 6, 7, 11, 8, 5, 8, 0, 5],  # 141 = 10001101
        [6, 7, 11, 2, 3, 10, 10, 5, 3, 10, 5, 8],  # 142 = 10001110
        [5, 9, 10, 10, 7, 11, 5, 10, 5, 11, -1, -1],  # 143 = 10001111
        [6, 11, 5, 5, 4, 6, 4, 7, 6, -1, -1, -1],  # 144 = 10010000
        [8, 4, 5, 11, 11, 7, 8, 11, 8, 3, 7, 4],  # 145 = 10010001
        [0, 3, 11, 1, 6, 5, 6, 11, 0, 6, 1, -1],  # 146 = 10010010
        [8, 4, 5, 11, 11, 7, 8, 11, 8, 3, 7, 4],  # 147 = 10010011
        [9, 5, 4, 1, 10, 6, 11, 10, 11, 7, 8, 3],  # 148 = 10010100
        [10, 0, 1, 10, 6, 0, 6, 11, 0, 6, 9, 5],  # 149 = 10010101
        [3, 10, 6, 0, 1, 11, 8, 3, 11, 5, 11, 1],  # 150 = 10010110
        [11, 10, 6, 7, 11, 6, 8, 4, 11, 8, 5, 4],  # 151 = 10010111
        [2, 3, 7, 11, 7, 8, 9, 5, 4, -1, -1, -1],  # 152 = 10011000
        [3, 2, 0, 7, 7, 9, 5, 7, 2, 9, 7, 4],  # 153 = 10011001
        [9, 5, 4, 2, 7, 8, 11, 10, 6, -1, -1, -1],  # 154 = 10011010
        [11, 10, 6, 2, 7, 0, 2, 9, 7, -1, -1, -1],  # 155 = 10011011
        [8, 2, 3, 8, 10, 2, 8, 5, 10, 9, 5, 8],  # 156 = 10011100
        [3, 10, 0, 1, 6, 11, 5, 6, 5, 4, 11, 6],  # 157 = 10011101
        [10, 6, 11, 5, 5, 4, 10, 5, 10, 9, 4, 3],  # 158 = 10011110
        [10, 6, 11, 9, 5, 4, 9, 4, 3, 9, 3, 2],  # 159 = 10011111
        [6, 11, 5, 5, 4, 6, 4, 7, 6, -1, -1, -1],  # 160 = 10100000
        [0, 3, 8, 7, 4, 5, 9, 10, 9, 5, 11, 10],  # 161 = 10100001
        [5, 1, 4, 5, 0, 4, 9, 10, 9, 4, 7, 10],  # 162 = 10100010
        [0, 1, 9, 8, 7, 11, 4, 7, 4, 5, 11, 7],  # 163 = 10100011
        [3, 11, 10, 8, 4, 7, 9, 4, 9, 5, 7, 4],  # 164 = 10100100
        [9, 5, 4, 0, 3, 2, 11, 10, 8, 7, -1, -1],  # 165 = 10100101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 1, 3],  # 166 = 10100110
        [9, 5, 4, 2, 11, 10, 3, 2, 10, 7, 3, 10],  # 167 = 10100111
        [4, 5, 1, 0, 11, 10, 7, 11, 7, 3, 10, 11],  # 168 = 10101000
        [11, 10, 7, 0, 1, 3, 0, 7, 4, 0, -1, -1],  # 169 = 10101001
        [4, 5, 9, 10, 11, 2, 11, 3, 2, -1, -1, -1],  # 170 = 10101010
        [2, 11, 3, 9, 10, 2, 5, 9, 2, 4, 9, 5],  # 171 = 10101011
        [4, 5, 1, 0, 3, 2, 11, 10, 8, 7, -1, -1],  # 172 = 10101100
        [0, 2, 11, 10, 8, 7, 0, 9, 2, 0, 5, 9],  # 173 = 10101101
        [0, 4, 5, 9, 10, 2, 3, 11, 7, -1, -1, -1],  # 174 = 10101110
        [2, 11, 10, 3, 0, 4, 9, 0, 2, 4, 0, 7],  # 175 = 10101111
        [8, 4, 7, 3, 9, 10, 9, 5, 10, -1, -1, -1],  # 176 = 10110000
        [0, 1, 5, 10, 5, 4, 3, 8, 7, -1, -1, -1],  # 177 = 10110001
        [10, 5, 4, 0, 1, 2, 7, 3, 8, -1, -1, -1],  # 178 = 10110010
        [9, 7, 5, 9, 5, 4, 10, 2, 1, -1, -1, -1],  # 179 = 10110011
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 180 = 10110100
        [5, 11, 10, 5, 10, 2, 3, 8, 7, -1, -1, -1],  # 181 = 10110101
        [4, 11, 10, 4, 9, 11, 7, 11, 9, 2, 11, 10],  # 182 = 10110110
        [3, 9, 7, 3, 10, 9, 10, 2, 7, 10, 9, 4],  # 183 = 10110111
        [8, 4, 7, 3, 9, 5, 10, 9, 10, 2, 11, 10],  # 184 = 10111000
        [5, 10, 9, 7, 5, 9, 4, 7, 9, -1, -1, -1],  # 185 = 10111001
        [0, 10, 2, 4, 9, 5, 7, 3, 8, -1, -1, -1],  # 186 = 10111010
        [0, 4, 7, 9, 0, 7, 10, 0, 10, 2, 9, 10],  # 187 = 10111011
        [8, 4, 7, 3, 11, 2, 9, 5, 10, -1, -1, -1],  # 188 = 10111100
        [9, 5, 10, 11, 2, 8, 11, 10, 3, 8, 10, 2],  # 189 = 10111101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 190 = 10111110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 191 = 10111111
        [9, 5, 4, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 192 = 11000000
        [0, 2, 8, 7, 0, 1, 5, 0, 5, 4, 2, 5],  # 193 = 11000001
        [0, 9, 5, 2, 3, 8, 2, 1, 3, -1, -1, -1],  # 194 = 11000010
        [9, 5, 4, 2, 3, 1, 3, 2, 0, -1, -1, -1],  # 195 = 11000011
        [8, 4, 7, 3, 9, 5, 10, 9, 10, 2, 11, 10],  # 196 = 11000100
        [0, 10, 2, 4, 9, 5, 8, 3, 1, 7, -1, -1],  # 197 = 11000101
        [7, 3, 5, 4, 3, 2, 5, 3, 10, 5, 2, 10],  # 198 = 11000110
        [9, 5, 4, 1, 7, 10, 3, 7, 2, 10, 7, 1],  # 199 = 11000111
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 200 = 11001000
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 1, 3],  # 201 = 11001001
        [11, 10, 5, 1, 3, 0, 7, 8, 4, -1, -1, -1],  # 202 = 11001010
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 203 = 11001011
        [9, 5, 4, 0, 11, 10, 1, 11, 0, 7, 11, 1],  # 204 = 11001100
        [11, 10, 1, 0, 7, 8, 11, 7, 1, 4, 11, 8],  # 205 = 11001101
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 206 = 11001110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 207 = 11001111
        [9, 5, 4, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 208 = 11010000
        [4, 9, 5, 7, 0, 1, 2, 7, 2, 11, 7, 1],  # 209 = 11010001
        [9, 5, 4, 7, 3, 8, 2, 7, 2, 11, 7, 3],  # 210 = 11010010
        [11, 2, 0, 1, 7, 4, 9, 7, 9, 5, 7, 1],  # 211 = 11010011
        [5, 4, 9, 8, 7, 10, 7, 2, 10, -1, -1, -1],  # 212 = 11010100
        [2, 7, 10, 5, 1, 4, 10, 2, 5, 7, 10, 4],  # 213 = 11010101
        [7, 5, 4, 10, 10, 3, 2, 10, 7, 3, 10, 4],  # 214 = 11010110
        [9, 5, 4, 7, 1, 10, 3, 7, 2, 10, 7, 1],  # 215 = 11010111
        [3, 4, 5, 1, 10, 7, 8, 10, 8, 2, 7, 10],  # 216 = 11011000
        [5, 10, 7, 4, 5, 7, 3, 10, 5, 3, 0, 10],  # 217 = 11011001
        [4, 5, 1, 0, 7, 8, 10, 7, 10, 2, 11, 10],  # 218 = 11011010
        [1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 0],  # 219 = 11011011
        [3, 4, 5, 9, 11, 10, 6, 11, 6, 2, 11, 10],  # 220 = 11011100
        [6, 11, 10, 9, 6, 10, 3, 4, 6, 3, 5, 4],  # 221 = 11011101
        [6, 11, 10, 9, 6, 10, 3, 4, 6, 3, 5, 4],  # 222 = 11011110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 223 = 11011111
        [9, 5, 4, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 224 = 11100000
        [4, 9, 5, 7, 0, 1, 2, 7, 2, 11, 7, 1],  # 225 = 11100001
        [9, 5, 4, 7, 3, 8, 2, 7, 2, 11, 7, 3],  # 226 = 11100010
        [11, 2, 0, 1, 7, 4, 9, 7, 9, 5, 7, 1],  # 227 = 11100011
        [5, 4, 9, 8, 7, 10, 7, 2, 10, -1, -1, -1],  # 228 = 11100100
        [2, 7, 10, 5, 1, 4, 10, 2, 5, 7, 10, 4],  # 229 = 11100101
        [7, 5, 4, 10, 10, 3, 2, 10, 7, 3, 10, 4],  # 230 = 11100110
        [9, 5, 4, 7, 1, 10, 3, 7, 2, 10, 7, 1],  # 231 = 11100111
        [3, 4, 5, 1, 10, 7, 8, 10, 8, 2, 7, 10],  # 232 = 11101000
        [5, 10, 7, 4, 5, 7, 3, 10, 5, 3, 0, 10],  # 233 = 11101001
        [4, 5, 1, 0, 7, 8, 10, 7, 10, 2, 11, 10],  # 234 = 11101010
        [1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 0],  # 235 = 11101011
        [3, 4, 5, 9, 11, 10, 6, 11, 6, 2, 11, 10],  # 236 = 11101100
        [6, 11, 10, 9, 6, 10, 3, 4, 6, 3, 5, 4],  # 237 = 11101101
        [6, 11, 10, 9, 6, 10, 3, 4, 6, 3, 5, 4],  # 238 = 11101110
        [5, 11, 10, 5, 10, 3, 4, 8, 7, -1, -1, -1],  # 239 = 11101111
        [4, 9, 5, 2, 3, 8, 2, 11, 3, -1, -1, -1],  # 240 = 11110000
        [2, 11, 3, 9, 10, 2, 5, 9, 2, 4, 9, 5],  # 241 = 11110001
        [2, 11, 0, 1, 5, 9, 5, 4, 9, -1, -1, -1],  # 242 = 11110010
        [2, 11, 0, 1, 3, 8, 2, 3, 2, 4, 9, 5],  # 243 = 11110011
        [11, 3, 2, 9, 9, 5, 4, 9, 11, 5, 9, 2],  # 244 = 11110100
        [9, 10, 5, 11, 10, 9, 11, 9, 2, 11, 2, 3],  # 245 = 11110101
        [5, 4, 10, 5, 10, 0, 3, 8, 11, 3, 11, 10],  # 246 = 11110110
        [11, 10, 5, 7, 11, 5, 4, 3, 11, 4, 8, 3],  # 247 = 11110111
        [2, 5, 8, 2, 8, 7, 4, 9, 5, -1, -1, -1],  # 248 = 11111000
        [9, 5, 4, 0, 1, 7, 0, 7, 3, 7, 1, 8],  # 249 = 11111001
        [1, 2, 5, 9, 1, 8, 5, 8, 7, 5, 8, 4],  # 250 = 11111010
        [5, 4, 0, 1, 5, 0, 7, 8, 5, 7, 11, 8],  # 251 = 11111011
        [2, 4, 5, 11, 11, 3, 2, 11, 4, 3, 11, 5],  # 252 = 11111100
        [3, 8, 11, 3, 11, 5, 4, 9, 5, -1, -1, -1],  # 253 = 11111101
        [9, 5, 4, 11, 11, 3, 2, 11, 4, 3, 11, 5],  # 254 = 11111110
        [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],  # 255 = 11111111
    ]
    
    def polygonizeScalarField(iso_level, grid, x_coords, y_coords, z_coords):
        def vertexInterp(iso_level, p1, p2, valp1, valp2):
            """
            Given a point (p1) and its scalar value (valp1), and another point (p2)
            and its scalar value (valp2), compute the point where an isosurface cuts
            an edge between vertices, and return the point.
            """
            if abs(iso_level - valp1) < 0.00001:
                return p1
            if abs(iso_level - valp2) < 0.00001:
                return p2
            if abs(valp1 - valp2) < 0.00001:
                return p1
            mu = (iso_level - valp1) / (valp2 - valp1)
            x = p1[0] + mu * (p2[0] - p1[0])
            y = p1[1] + mu * (p2[1] - p1[1])
            z = p1[2] + mu * (p2[2] - p1[2])
            return x, y, z
    
        def polygonizeCube(iso_level, cube, x_coords, y_coords, z_coords):
            """
            Polygonize a single cube of the grid.
            """
            vertices = [None] * 12
            # Indices of the vertices where the isosurface intersects the edges
            cube_index = 0
            if cube[0] < iso_level:
                cube_index |= 1
            if cube[1] < iso_level:
                cube_index |= 2
            if cube[2] < iso_level:
                cube_index |= 4
            if cube[3] < iso_level:
                cube_index |= 8
            if cube[4] < iso_level:
                cube_index |= 16
            if cube[5] < iso_level:
                cube_index |= 32
            if cube[6] < iso_level:
                cube_index |= 64
            if cube[7] < iso_level:
                cube_index |= 128
    
            # Cube is entirely in/out of the surface
            if self.edge_table[cube_index] == 0:
                return []
    
            # Find the vertices where the surface intersects the cube
            if self.edge_table[cube_index] & 1:
                vertices[0] = vertexInterp(iso_level, (x_coords[0], y_coords[0], z_coords[0]), (x_coords[1], y_coords[1], z_coords[1]), cube[0], cube[1])
            if self.edge_table[cube_index] & 2:
                vertices[1] = vertexInterp(iso_level, (x_coords[1], y_coords[1], z_coords[1]), (x_coords[2], y_coords[2], z_coords[2]), cube[1], cube[2])
            if self.edge_table[cube_index] & 4:
                vertices[2] = vertexInterp(iso_level, (x_coords[2], y_coords[2], z_coords[2]), (x_coords[3], y_coords[3], z_coords[3]), cube[2], cube[3])
            if self.edge_table[cube_index] & 8:
                vertices[3] = vertexInterp(iso_level, (x_coords[3], y_coords[3], z_coords[3]), (x_coords[0], y_coords[0], z_coords[0]), cube[3], cube[0])
            if self.edge_table[cube_index] & 16:
                vertices[4] = vertexInterp(iso_level, (x_coords[4], y_coords[4], z_coords[4]), (x_coords[5], y_coords[5], z_coords[5]), cube[4], cube[5])
            if self.edge_table[cube_index] & 32:
                vertices[5] = vertexInterp(iso_level, (x_coords[5], y_coords[5], z_coords[5]), (x_coords[6], y_coords[6], z_coords[6]), cube[5], cube[6])
            if self.edge_table[cube_index] & 64:
                vertices[6] = vertexInterp(iso_level, (x_coords[6], y_coords[6], z_coords[6]), (x_coords[7], y_coords[7], z_coords[7]), cube[6], cube[7])
            if self.edge_table[cube_index] & 128:
                vertices[7] = vertexInterp(iso_level, (x_coords[7], y_coords[7], z_coords[7]), (x_coords[4], y_coords[4], z_coords[4]), cube[7], cube[4])
            if self.edge_table[cube_index] & 256:
                vertices[8] = vertexInterp(iso_level, (x_coords[0], y_coords[0], z_coords[0]), (x_coords[4], y_coords[4], z_coords[4]), cube[0], cube[4])
            if self.edge_table[cube_index] & 512:
                vertices[9] = vertexInterp(iso_level, (x_coords[1], y_coords[1], z_coords[1]), (x_coords[5], y_coords[5], z_coords[5]), cube[1], cube[5])
            if self.edge_table[cube_index] & 1024:
                vertices[10] = vertexInterp(iso_level, (x_coords[2], y_coords[2], z_coords[2]), (x_coords[6], y_coords[6], z_coords[6]), cube[2], cube[6])
            if self.edge_table[cube_index] & 2048:
                vertices[11] = vertexInterp(iso_level, (x_coords[3], y_coords[3], z_coords[3]), (x_coords[7], y_coords[7], z_coords[7]), cube[3], cube[7])
    
            return vertices, self.tri_table[cube_index]
    
        # Initialize triangles and vertices
        triangles = []
    
        # Traverse each cube in the grid
        z = 0
        while z < len(grid) - 1:
            y = 0
            while y < len(grid[0]) - 1:
                x = 0
                while x < len(grid[0][0]) - 1:
                    cube = [
                        grid[z][y][x],
                        grid[z][y][x + 1],
                        grid[z][y + 1][x + 1],
                        grid[z][y + 1][x],
                        grid[z + 1][y][x],
                        grid[z + 1][y][x + 1],
                        grid[z + 1][y + 1][x + 1],
                        grid[z + 1][y + 1][x],
                    ]
                    x_coords_cube = [x_coords[x], x_coords[x + 1], x_coords[x + 1], x_coords[x], x_coords[x], x_coords[x + 1], x_coords[x + 1], x_coords[x]]
                    y_coords_cube = [y_coords[y], y_coords[y], y_coords[y + 1], y_coords[y + 1], y_coords[y], y_coords[y], y_coords[y + 1], y_coords[y + 1]]
                    z_coords_cube = [z_coords[z], z_coords[z], z_coords[z], z_coords[z], z_coords[z + 1], z_coords[z + 1], z_coords[z + 1], z_coords[z + 1]]
                    vertices, triangles_indices = polygonizeCube(iso_level, cube, x_coords_cube, y_coords_cube, z_coords_cube)
                    # Add the triangles and vertices to the result
                    for triangle_indices in triangles_indices:
                        triangle = []
                        for vertex_index in triangle_indices:
                            triangle.append(vertices[vertex_index])
                        triangles.append(triangle)
                    x += 1
                y += 1
            z += 1
    
        return triangles